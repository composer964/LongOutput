import json
import os
from openai import OpenAI

from openai import OpenAI
os.environ['http_proxy'] = 'http://127.0.0.1:7890'
os.environ['https_proxy'] = 'http://127.0.0.1:7890'
from dotenv import load_dotenv  # 导入库

# 1. 加载 .env 文件 (默认读取当前目录下的 .env)
load_dotenv()
# 1. 配置你的 API (可以用 OpenAI，也可以用兼容 OpenAI 格式的 DeepSeek/Qwen 等)
client = OpenAI(
    # This is the default and can be omitted
    base_url=os.getenv('OPENAI_API_BASE'),
    api_key=os.getenv('GEMINI_API_KEY')
)
MODEL_NAME = "gemini-2.5-pro"  # 或者 "deepseek-chat"


def structure_plan_to_json(plan_text):
    """
    中间层：将非结构化的 Markdown 大纲转化为结构化的 JSON 列表。
    这样我们可以用代码遍历每个章节。
    """
    print("正在将文本大纲转化为结构化数据...")
    prompt = f"""
    我有一个文章大纲，请帮我将其转换为标准的 JSON 格式，以便代码处理。

    【大纲内容】:
    {plan_text}

    【要求】:
    请直接输出一个 JSON List，不要包含 Markdown 格式（如 ```json）。
    List 中的每个元素是一个 Object，包含以下字段：
    - "title": 章节标题
    - "instruction": 该章节的写作指导/摘要
    - "word_count": 预估字数（数字，例如 500）
    """

    try:
        response = client.chat.completions.create(
            model=MODEL_NAME,
            messages=[{"role": "user", "content": prompt}],
            response_format={"type": "json_object"}  # 强制 JSON 模式 (如果模型支持)
        )
        content = response.choices[0].message.content
        # 简单的清洗，防止模型偶尔加 markdown 标记
        if "```json" in content:
            content = content.replace("```json", "").replace("```", "")

        # 尝试解析，通常模型会返回 {"sections": [...]} 或直接 [...]
        data = json.loads(content)
        if isinstance(data, list):
            return data
        elif "sections" in data:
            return data["sections"]
        else:
            # 兜底：假设是一个 dict，取第一个 value
            return list(data.values())[0]

    except Exception as e:
        print(f"大纲结构化失败: {e}")
        return []


def write_section(transcript, full_plan, section_info, previous_content):
    """
    执行层：撰写单个章节
    """
    try:
        with open('prompts/write.txt', encoding='utf-8') as f:
            template = f.read()
    except FileNotFoundError:
        print("错误：请先创建 prompts/writer.txt")
        return ""

    # 截取上文的最后 500 个字符作为 Context，避免上下文过长干扰，同时保持连贯性
    short_prev_context = previous_content[-500:] if previous_content else "（这是文章的开头）"   # TODO 优化 LLM summary

    prompt = template.replace('$TRANSCRIPT$', transcript) \
        .replace('$FULL_PLAN$', full_plan) \
        .replace('$SECTION_TITLE$', section_info.get('title', '')) \
        .replace('$SECTION_INSTRUCTION$', section_info.get('instruction', '')) \
        .replace('$PREVIOUS_CONTEXT$', short_prev_context) \
        .replace('$WORD_COUNT$', str(section_info.get('word_count', 500)))

    print(f"--> 正在生成章节: {section_info.get('title')} ...")

    response = client.chat.completions.create(
        model=MODEL_NAME,
        messages=[{"role": "user", "content": prompt}],
        temperature=0.7,
        timeout=400
    )
    return response.choices[0].message.content


if __name__ == '__main__':
    # 1. 加载数据 (模拟上一步 plan.py 的输出)
    # 实际使用时，你可以把 plan.py 的输出存成文件读取

    # 假设这是 plan.py 生成的 Plan 字符串
    raw_plan_text = """
    好的，遵照您的指示，我将以世界顶级演讲撰稿人的身份，运用孙宇晨的语言风格，为您规划一篇极具煽动性的TED风格演讲稿大纲。

在深入分析原始素材后，我提炼出了一个核心冲突：**社会预设的“成功模板”与个体追求真正自由之间的矛盾**。孙宇晨的论述本质上是在号召一场针对传统人生路径的“独立战争”。

以下是为您精心构建的演讲大纲（Step 2）。

---

### **Step 2: 构建演讲大纲 (The Plan)**

#### **1. 演讲标题 (3个备选)**

1.  **《觉醒，还是沉睡？——新一代的财富自由宣言》** (强调思想启蒙与革命性)
2.  **《打破人生脚本：你不是程序的执行者》** (运用核心比喻，极具冲击力)
3.  **《财富自由革命：投资你自己，颠覆旧世界》** (宏大叙事，直接点明核心方法论)

#### **2. 核心主旨 (Core Message)**

真正的财富自由，不是拥有花不完的钱，而是挣脱社会预设的“人生程序”，将你自己作为最核心的资产进行投资，从而获得精神与物质的双重解放。

#### **3. 结构蓝图**

**【引言 (Hook)】** (预估字数：100字)

*   **开场方式**：以一个普遍的幻想开场，然后迅速颠覆它。
*   **设计**：“提到财富自由，你们想到什么？是退休、游艇、环游世界？（停顿）……如果我告诉你，这根本不是自由，而是一个更精致的牢笼呢？今天，我不是来教你如何赚钱退休，我是来邀请你，与我一同开启一场革命，一场通往真正自由的革命。”

**【现状挑战 (The Problem)】** (预估字数：300字)

*   **核心痛点**：我们都活在一个被预设好程序的“黑客帝国”里，被动地执行着一套标准化的人生脚本，用战术的勤奋掩盖了战略的懒惰。
*   **逻辑展开**：
    1.  **引入“人生程序”概念**：我们从出生就被植入了一套程序：毕业、买车、买房、结婚。我们像代码一样被执行，从不反思“为什么”。
    2.  **揭示“伪奋斗”陷阱**：我们每天都很忙，996，拼命工作，但这只是“战术上的勤奋”。我们忙于执行程序，却懒于思考自己人生的“顶层战略”。
    3.  **点燃焦虑**：这种被动的人生导致了最终的结局——勤劳，却不富有。不是金钱上的不富有，而是精神上的彻底贫瘠。你的人生，究竟是你自己的选择，还是社会为你编写的剧本？

**【核心观点段落 (The Solution)】** (预估字数：2000字)

**模块一：思想觉醒 (The Awakening) - 拔掉你脑后的插头**
*   **小标题**：第一步：成为思想的“异类”
*   **核心逻辑摘要**：革命的第一步是思想解放。你必须成为那个敢于质疑系统、挑战默认选项的“程序异常者”，从“为别人活”的思维定势中挣脱，开始为自己制定战略。
*   **拟引用的关键素材/金句**：
    *   **类比**：“我们就像活在《黑客帝国》里，而我，希望成为那个唤醒你的尼奥。觉醒的过程是痛苦的，但正如斯宾诺莎所说：‘宁要战争的自由，也不要和平的奴役！’”
    *   **金句**：“太多人把父母、配偶、孩子当成了自己人生的战略，却从未想过，**你自己，才是你人生的唯一战略！**”
    *   **反思**：“你有没有问过自己：我是谁？我从哪里来？要到哪里去？嘲笑这些终极问题的人，永远过不好这一生。”
*   **预估字数**：500字

**模块二：资本重构 (The Capital Re-allocation) - 你就是你最伟大的资产**
*   **小标题**：第二步：All in 你自己
*   **核心逻辑摘要**：年轻人最稀缺的资本是时间和金钱。与其将有限的资本投入到你无法控制的外部资产（如房产、股票），不如将其100%集中投资于你唯一能完全掌控的、回报率最高的资产——你自己。
*   **拟引用的关键素材/金句**：
    *   **案例**：“你们问我该投资什么？腾讯股票？北京的房子？不！这些机会不属于你。一个五百万的房子和一个五亿的保险公司，对一个年轻人来说没有区别，因为你都买不起！”
    *   **个人故事**：“我投资比特币，不是简单的投机。那是我对我信仰的事业投下的一张票，是我给我自己交的‘党费’！这才是投资的真谛——**让你的事业与你的投资合二为一**。”
    *   **金句**：“别再研究K线图了，研究一下你的体检报告；别再分析楼市政策了，分析一下你的知识短板。**投资你的健康、你的认知、你的事业，这才是通往财富自由的唯一正道。**”
*   **预估字数**：800字

**模块三：规则颠覆 (The Rule Breaking) - 解构三大社会神话**
*   **小标题**：第三步：拆掉束缚你的三座大山
*   **核心逻辑摘要**：觉醒之后，必须在行动上打破旧世界的规则。重点解构房产、婚姻和消费这三个捆绑当代年轻人的最大枷锁，展示一个更轻盈、更高效、更自由的生活范式。
*   **拟引用的关键素材/金句**：
    *   **房产神话**：“用三代人的积蓄买一套房，你得到的不是家，而是一家拥有12个股东（双方父母、祖父母）且人人拥有一票否决权的‘有限公司’。你的人生，将被这张资产负债表彻底锁死。”
    *   **婚姻神话**：“婚姻是最高风险的合伙人制度。它没有退出机制，一旦退出就意味着公司倒闭、资产清算。在没有与你的‘合伙人’深度磨合之前就闪婚？我只能说，你们真会玩。”
    *   **消费神话**：“我身价过亿，但我名下没有一辆车。为什么？因为我没时间。共享经济给了我最高效的出行方案，把开车变成办公。**真正的自由，是选择的自由，而不是拥有的负担。**”
*   **预估字数**：700字

**【愿景与号召 (Vision & Call to Action)】** (预估字数：200字)

*   **升华主题**：从个人选择上升到时代精神，描绘一个由无数“觉醒者”构成的新世界。
*   **情绪引导与号召**：
    *   **愿景**：“想象一个世界，在这里，我们不再被房价绑架，不再为婚姻焦虑，不再为消费主义所累。每个人都像一个高速成长的创业公司，把所有资源都聚焦于自身的迭代与突破。这，就是我们这一代人的革命！”
    *   **号召**：“革命，从今晚开始。不要打开炒股软件，不要浏览房产中介。关掉手机，拿出一张白纸，写下你人生的战略。问自己一个问题：如果人生是一款游戏，我，想玩出个什么结局？”
    *   **结尾**：“**制定你的战略，All in 你自己。我在财富自由的另一边，等着你。**”
    """

    # 假设这是原始转录文本
    transcript_text = """
大家好，我是陪我APP创始人孙雨辰，我想邀你一起与我踏上财富自由革命之路，我在财富自由的另一边等着你。财富字有多好看，马上就可以退休牛山玩水了，对吧？呃，我个人感觉啊，就是这个其实也是我们这个节目要主要讲的嘛财富自由革命之路嘛。其实我节目里面我就会反复强调，其实财富自由本身首先是一种精神自由。这个并不是说钱多到花不完了啊，其实我个人包括我平常跟员工交流，我都说过，其实一个人的钱要多到花不完。其实即便在北京，嗯，只要你不要买房买车，不要啊，就我这讲的买房买车，结婚吧，三件事，你先别干，暂停下来。先想一想，我觉得在北京月薪一万就已经够多了啊，就已经完全花不完啊。如果对于比如说我当时在北大那种穷学生的状态，我觉得月薪五千就已经足以了。基本上因为租房可能就如果住宿舍就花一千块钱，一个月都已经差不多了。然后其实剩下的钱要吃饭，有的公司还包饭，像我们公司应该都是包晚餐的吧。那这样的话，好多真真的是花不了什么钱啊，花不了什么钱，除非你要这个嗯要结婚啊，要后面有一堆责任，你需要承担。在此之前，其实多人就已经处于一个钱花不完的状态了。嗯，在这种情况下呢，我个人觉得就是首先精神自由很重要。精神自由其实到时候课上我会说很多，但是在我自己这里认为啊，精神自由首先是找到归宿，知道自己什么什么样的人，愿意在一个什么样的事业中奋斗，愿意为这个事业做出什么。有一种事业结和精神上的认同，我觉得这是核心。嗯，我一直被这个困扰的很厉害，包括一一直比如说一年一二年呢，一直就不知道自己该以后从事什么行业，也不知道自己以后该干什么啊，不知道自己这个人呢就是一个什么方向，很迷茫啊，我觉得这个东西最恐怖的尽早摆脱这种状态啊，选择一条好的道路是核心。所以我其实包括我做这喜马拉雅之前啊，我在陈向东的那个跟谁学上，做过一期节目讲，我在马云大海湖畔大学学到什么？讲的是战略啊，其实当时我就说一个公司战略很重要，人的战略也很重要。什么时候人？那你最基本的先把自己的战略做对了。所以我是非常反对很多的年轻人，就是啥都没想到，战略也没做，直接蒙头战婚，把结婚当战略，生小孩当战略，买房当战略还是要想的更深刻一些。把自己很多好多人啊，就是比如说中很多中国人根本就没有活明白过。把父母当战略，把老婆当战略，把小孩当战略，把老婆当战略，从来就没有把自己的人生，把自己当过战略是吧？很多人有可能，比如说自己混的不好，甚至把这个混的好的希望寄托在小孩身上了。那你给别人多大的压力啊，你没有任何必要把自己当战略，想清楚自己做什么事情，这是最重要的，真的是最重要的。所以其实从这个角度来说，财富自由并不是要很多钱才能实现。首先在这个层面想先确立精神自由。其实听完我们课，大家知道它是有非常多的路径，可以通向财富自由的。而且这个时候等你拿到财富自由的时候，你肯定不是想到是一夜暴富退休是吧？其实你后来想想，如果你你退休了，你干啥呢？每天啊如果是玩游戏状态的时候，连七天我觉得都撑不住，都会玩到崩溃。游戏之所以啊具有那么强的吸引力，重大的原因就是因为你是游戏和工作室交替进行的。如果是纯游戏，很多人有可能就是嗯我觉得七都会崩溃，溃信信有观观众以试一试啊，我就可以试一试，玩玩七天一般都会崩溃的。所以嗯我个人感觉就是财富自由啊，其实嗯甚至包括不用不一定要实现财富的精神自由。你实现之后，你就会发现你眼前有一条非常清晰的道路在慢慢展现出来。啊，所以其实你自己慢慢也会知道会做什么。其中如果是退，就是这种退休啊、游山玩水啊我相信你，只要坚持一个月就基本就玩不下去了，就很想回到现实生活。嗯，种其实我觉得并不是财富自由人才体现过体体验过吧。就是举个例子，就是以前我们放暑假经常放出鸟来了钱，第一个月是很兴奋的，到第二个月就巴不得开学了。其实很多人都是这样的，我包括我自己也是这么想的，为什么多数人年轻人勤劳却不富有这个问题呢？其实我自己非常深刻的想法。其实刚才那个问题也都答了不少了。嗯，绝大多数人勤劳而不富有的核心原因呢就是没有做战略，其实要简单回答，就这么简单。就是因为没有做战略。很多人啊一直觉得啊好像战略是个很大的词，马云才做战略，我做啥战略呢？小公司也不用做了，我人也不用做了，其实恰恰恰恰相反，就跟我们经常讲的就是就是没钱人更应该做呀。哥们儿，这是决定成功的唯一因素。你连你这么穷还不做，那怎么可能赚到钱呢？对吧？那马云有可能不做战略损，损失还没那么大，你不做战略就玩完了，我就个人是更应该做战略的。我就首先所有事你不要想想着哦，赶紧撸起袖子去管别别别你先想清楚，就是人生是为了啥，为啥要干这些事情，这些事情有什么么处？那那个人情符符符合的初心，你是谁？从从哪来到哪里去，先把这这个更根本问题想清楚。很多人有时候想时候觉得还嘲笑想这种问题的人啊，你脑子是有病什么的是吧？你如果这个问题都没想清楚，是绝对一人生都过不好，当然会导致这个勤劳而不富有的问题。也是我们经常讲这创业圈很流行，一句话，就是用战术上的勤奋掩盖战略上的懒惰嘛。就是你每天好像感觉自己很忙，其实一件事都没做成，就这个道理。就我举一个例子，还是刚才那个例子，像中国绝大多数人就好像被植了一个程序，大学一毕业就得冲着买车买房结婚三部曲。你知道吗？无论各行各业从事啥都得往这个去，你知道吧？啊，就好像有点像，不知道大家看过那个电影，黑客帝国没有啊，就是黑客帝国里面那些人其实都是假人，都是电脑制造出来的嘛。就是人脑袋后面是给插了一个那种就是那种叫做什什么一个制器器是吧？他那个程序是自动输入的，所以你是其不自具有任何自己的自主人格的和自由意志的。因为那个都变了编程变好的。在我看来，就中国人现在有点像活成黑客帝国里面的感觉了，就绝大多数人不会反思的，就为啥结婚，为什么要买车？为什么要买房子？绝大多数不会反思，蒙着头就像执行程序一样就开始执行了，你知道吧？这我觉得是非常恐怖的。我觉得我甚至录这个节目的状态就非常像那个大家看黑客帝国里面那个leo, leo就是人类程序中第一个发生异变。他觉得哎大家怎么活的这么奇怪呢？不对劲。所以不是，他后来被称为叫救世主嘛，叫那个就是西安的救世主嘛。原因就是因为他是那个自主程序里面第一个出现异化的。就是当然他是因为用应该程序出了点bug吧，就是开始不按照这个电脑设置的程序去走了。就从这个角度来说，就是这个道理。绝大多数人青劳而不富有的核心原因是没有做战略，因为他战略上完全没做，所以他就按照既定的程序在运行。所以先从这个程序中醒过来是富有的。首要条件是头条，就跟leo他们在拯救黑客帝国的时候，不知道大家看过没有？这个真的是很值得看。他们就是要把所有的人类就是你脑袋后面那个东西给你拔掉，让那个人醒过来啊。当然其实这个本身是错误的，很多人还会骂leo,因为那些人被机器人啊插的那个培养敏理啊，其实活的很幸福。当时结果拔掉了那个醒了的面临外外星的围剿，就那个机电脑对这种醒来的人进行围剿啊，到处追杀他们，然后活的非常惨。因为你都被追杀呀，那你不可能活的像以前被豢养的羔羊一样了吗，对吧？但是我觉得这难道不就是人类获得解放的真谛吗？就是斯宾诺莎讲过一句话，宁可要战争的自由，也不要和平的奴役。就是这个意思。虽然大家都喜欢和平，没有人喜欢战争，对不对？但是当这个矛盾如果变成了奴役和自由的关系的话，任何一个正常的人还是希望选择战争战争的自由啊，其实就就是这个道理，你会投资，那你告诉我应该投资什么让自己快速致富呢？现阶段啊，其实其实投资本身呢啊是一个很大的命题，肯定很多人要花一辈子的时间才能学会投资。包括比如说大家知道是我们校校友了啊，全世界最会投资的人。其实投资本身呢，我觉得现在有很多标的其实还都是不错的。举一些例子，比如说一些非常优秀的互联网公司的股票，我觉得都很不错。举个例子啊，你像腾讯的股价都从来没跌过，对吧？啊，其实是你要从投资角度来讲，我觉得至少目前其实买腾讯的股票都是没有任何风险的。包括比如说嗯虽然我在这个节目里面说了，就是不要再把把买房当做一个战略。但是我觉得如果你有很多钱的话，其实在北京北上广买房就是在一线吧，毕竟至少是北京和上海买房，至少也不会是赔本生意。但是这都不是我所推荐的啊，这个节目里面大家也会听啊，就是我会讲很多，这也是不是我所推荐的。其实我最推荐的是投资自己，这也是我其实前面都讲了很清楚了。就绝大多数人最大的问题是，比如说他们刚才前前面买房买车结婚，包括父母很多人是为父母活着的呀，就是好像活在人生中，就是要为父母尽孝。你懂我的意思吧？有的人就是要为老婆活着，为小孩活着，为那个车活着，为那个房子活着。所有人都没有一天意识到自己该为自己活着，为自己活着。首先我觉得一点都不自私，因为我我没想清楚，如果你一个人连为自己活着都做不到，你还怎么为你老婆活着？就是如果我老婆跟我说，说孙先生我就原永远是为你活着，我会感觉很恐怖，你知道吗？因为我感觉她如果连为自己活着的能力都没有，他难道会有能力为我活着吗？这根本就是不可能的事情，对吧？所以绝大多数人，你说我们去投资别的东西，比如你哪怕投资资京的房子，投资腾讯的股票，你首先都忽略了，你自己才是这个最应该被投资的人。而且你说你了解北京的房价，还是了解腾讯的股价，你又不是马化腾，是不是啊？但是你绝对是最了解自己的吧。你对自己是个什么样的人，最需要补齐哪块短板，最需要在哪些地方取得人生和职业化的突破？这些你都是最了解的，包括你一个人自己怎么样取得好的发展，你都是应该把这些时间、精力、金钱全放在这个上面。尤其是绝大多数的九零九五后，本来时间金钱就是非常有限的。你腾讯现在这股价两百多块钱一股，你要买一百股都得两万块钱，绝对绝大多数九零后来说，九五，后来说拿出两万都勒紧裤腰带半天吧，何必呢？对，牛逼。的确你投了两年，腾讯股价涨成三万了啊，涨成三百块钱，一股你赚了一万块钱。但是如果你把最简单的，你就这两万别投资了，多买几个鸡蛋吃了。对你身体的帮助也要比这腾讯股价涨了一万块钱，对你帮助至少是大吧。所以我个人感觉就是包括我后面会讲投资，你包括投资自己的身体，投资自己的健康，投资自己的职业发展，包括投资自己的事业，这都是最重要的。所以我觉得大家不要去想，好像啊我去投资买个我首先我觉得呢这个世界上除了买彩票，不可能出现那种一夜暴富的情况。嗯，所以不要去想投资什么东西，除了你自己之外，甚至包括我举个例子，就当初投比特币。那你说哎说顺一，那你投比特币不是是了了别的东西吗？对吧？但是大家是了解当时我们这个情况况，我们买比特币并不是说是所像我去买了一个腾讯股股票，样样的。比如说买北京的房子，这种简单的投资，我投资比特币，是因为我当时就是为比特币这种加密密码学货币的特性给吸引了。甚至我当时就开始就我当时虽然就是表面上在准备法学院的考试啊，但是我当时的职业发展就是想毕业之后成为一位为比业了在全球取得合法性而奔走的人。这比特币买啊，相当于我交他党费，你知道吗？就是所以这也是为什么比特币后来涨得我们那么激动，就跟你加入中国共产党，中国共产党终于建国了的那种激动的感觉。所以从这个角度来说，比特币其实对我来说也不完全是大家理解的。这种就是加个引号的投资，是不是啊？这种其实是对于一种个人信仰，对个人事业的一种投票。就是如果我觉得如果任何一个人，你现在是在腾讯工作的话，你又看好这家公司。我当然是建议你试花你所有的钱去买腾讯发给你的期权，那是应该你真正去买的。因为这不仅仅是腾讯公司的股票，同时也是你的事业啊，所以我是非常其实鼓励年轻人。当然后面是加入创业公司，去获得创业公司的期权，然后去买入创业公司的期权的。一定要把这个投资跟你自己的事业结合起来。因为一个人本来其实就没有多少资本，你一定要把所有的事情跟你自己结合起来，我觉得这才能真正取得资源的集中优势，就获得成功。为什么到现在都不结婚？你已经二十七岁了，其实今年还算二十六吧哈。二十六岁，我九零年的。的确我觉得其实我作为男生压力小一点，但是好像的确在中国这种奇葩的国家，如果你二十六岁还没结婚，如果你是个女的，这个问题是绝对会被所有人问的。就包括啊我之前有些前女友跟我分手的重大原因，就是因为他看不到跟我在未来三年内结婚的可能性，甚至绝大多数女的根本就不是等三年三十六个月，开玩笑，六个月没有反应，人家就要叫那个啥了。当然我是不同意的。你我是非常欣赏这种欧美的社会环境，就是所有人啊人生目标并不是结婚，而是他自己和个人业业的发展。这这种社会态啊，所有有人也不会为他否选择择结婚。而但社会交代一下，你知道就就跟就犯犯罪分子要交代你的犯罪动机一样，就是你不结婚婚要要交代你的不结婚动机。这个社社会很奇怪，怪啊，结婚的你不用交代自己的结婚动机，但不结婚的结婚不结婚的动机，这是莫名其妙啊。所以我希望中国甚至十到二十年这个现现状能够改变啊。嗯，如果回到婚姻本身，我个人觉得婚姻本质是一个婚姻本质当然是组建家庭，其实就是选择你的家庭的合伙人，而他这种选择合伙人的方式要比公司选择合伙人还要恐怖的多。因为公司选择合伙人，比如说你们谈不拢了，闹掰了还可以退出。就是比如说我们公司举个例子，打个比方，现在当然没有了。如果有合伙人，比如说跟我随权闹不好，然后我跟他说好，那你现在可以退出了是吧？比如说我们把你这部分股份书买回去也好，是怎么也好，他可以退出。但是家庭合伙人是没有退出机制，退出的那一天就意味着公司的倒闭意味着家庭的破裂。所以其实嗯在我看来，这种合伙人制度本身有点变态啊，现实生活中除了家庭，没有人会会设计这种公司制度的，至少是没有人就你们俩如果当合伙人，就你们俩任何人要退出，你们公司必须立刻倒闭，然后所有财产就立刻清算，然后俩人一人分一半是吧？啊，这种就是完。首先一你可以看到有几个问题，一完全大锅饭嘛是吧？二就是退出机制，就是毁灭机制是吧？所以在这种情况下，我觉得找合伙人要慎之又慎。甚至我觉得嗯两一个人在结婚前至少要比较紧密的生活，至少两年一年，我就是底线。现在有很多闪婚文件，我看来我靠，太牛逼了。会玩啊，只能说会玩，就我觉得至少得生活一年吧。啊，这是最基本的，你才能了解这个人跟你合不合得来。能不能在很多生活出现重大问题的时候，两个人能保持一致。这些所有东西都至少我觉得在一年这是最基本的啊，所以我个人感觉在结婚这件事情上，首先先一不结结婚为目。而而且我觉得我以前如果这一辈子都没有结婚，其实也不是一个很大的罪或者是一件事情没有完成。但是我也希望自己能够发现自己真正喜欢的另一半，并且跟他在一起。但是我觉得在这件事上至少我会啊非常谨慎。最近房价涨得这么厉害，买不买啊？我觉得这个其实问题因人而异吧。嗯，首先我觉得首先一我我我个人认为呢，首先我并不对一线的房价看空。虽然我觉得中国二三线的房价的确是泡沫非常严重了，就是非北京和上海地区的房价，我觉得都泡沫化很严重，甚至包括深圳。我觉得深圳未来它城市的发展，其实有赖于这个城市本身进一步的提升了。嗯，如果但现在我觉得显而已经透支了，因为深圳房价比上海还高，这简直是没有任何理由。但是比如说就按我觉得会涨的北京跟上海的房价来说呢，首先一我觉得涨幅也是比较有限了。首先你说以前这十年涨了十几倍，虽然再十年再涨十几倍嘛，这时候肯定是不可能的啊啊，只不过过这涨房房价比火星还高了，这是不可能的。其次呢，我觉得房价是因人而异的。对于绝大多数九零和九五后来说呢，我觉得是买不起的。其实本质是嗯就是房价属于，即便它会涨，这属于一个九零后九五后无能力参与的机会。这个世界上你无能力参与的投资机会，不光房子简直太多了，好不好？举个例子啊，最近葡萄牙还有一个保险公司要私有化呢，我钱放进去就能赚钱，但是要五个亿，你参加吗？对吧？就你根本就没有五个亿嘛，哥们儿就怎么参加呢？是吧那只有有五个亿的人才能参加啊，就比如说北京上海房子，一套房子至少起效五百万以上吧。哥们，那就跟其其实我觉得对于绝大多数九五后来说五百万跟五个亿没有任何差别，你都付不起嘛，对吧？所以这就是不属于你的投资机会，就根本是一个。所以你就根本就不用去纠结买不买得起房。因为这个东西就根本就跟你没关系啊，就很简单嘛，就跟刚才那五个亿的保险公司一样，那入股的确能赚钱，你入得了吗？问题是啊，房子也是啊，就是这五百万，你根本就买不起嘛，是吧？以你现在的现金流做担保什么的，银行不敢借给你钱，就让你去买啊，是吧？除非你当然要得，就我们经在讲的是三代人供一套房，把你爷爷奶奶父母全用尽，而且是两方，是不是啊？全用尽。但这时候你就你就你就会发现个问题，对，的确是很有可能这个投资机会你是抓住，但是这个世界上没有免费的午餐。如果你比如说一方是双方父母四个人吧，在家爷爷奶奶姥姥姥爷。如果全参与进去，这事儿，你你和你老婆组成的这个有限公司啊，后面就有十二个股东，而且人人都有否决权，这很正正常。因因人家参与与你们公司的组建呢，是吧，你就得伺候好这些股东。所以如果你啊这时候再来抱怨说我奶奶这个房子，我爸我妈每天又怎么了，我奶奶爷爷又怎么了？那就没有什么可以抱怨的吗？因为这是理所当然的呀，对吧？人家参与了你公司的组建，怎么能不分红呢？对不对？这当然是非常正常的。而且其实绝大多数我们其实年轻人啊，因为缺乏最基本的投资，对投资门槛的理解。其实很多人买房也不会，他一定会买到最贵的，最容易被套住的价格。因为买房其实本身也是个非常复杂的事情。不是说啊，其实甚至连买房我觉得都就算去买房，也可以开十节课讲清楚啊，非常复杂，不是说你想买就买的。所以对于绝大多数年轻来说，如果他买了房，我认为他是提早进入了一个。他根本没有经济实力、没有投资实力、没有辨别能力的危险领域。他最后会为这个决策付出非常大的人生代价，真的是非常大的人生代价。因为甚至很多人买房，其实并不是为了投资。绝大多数买房是为了结婚，他会把他这个婚姻也变得是更加的可以说是死无葬身之地了。因为这时候他会发现，甚至是连过不下去不能离了。因为这一个房子把人绑的是如此之紧密啊，就是不光把他和他老婆绑进去了，把他老婆的父母，把他父母，把姥姥、姥爷、爷爷奶奶两方的一共十二个人，加上他们十四个人绑在一套房子里了。这时候关系是复杂吧，我觉得已经不亚于巴以冲突朝核问题是吧？等一些就是让我国领导人都很头痛的问题了，这基本都梳理不清楚了。所以我个人认为与其翻到房价涨的这么，其实我觉得其实就以最近涨得最疯狂的房价来看，北京应该整体成交均价环比也就才上涨了百分之十到十五而已。这大概从四万五涨到五万五，好像听见涨了很多啊，都从四万涨五万。其实你说四万涨五万不就四万五，涨到五万五也涨了百分之二十嘛，而且这还成交均价。所以从这个的角度来讲，我个人认为就是我从后来也会讲，以这种投资的角度来说，年轻人有太多地方投资可以超过百分之二十了。你就包括腾讯的股价都不止涨百分之二十。我自己做移移动角联百。所以你我们竟然都在公司聊那微博、陌陌很多我们自己耳熟能详的公司是吧？这一年股价至少都翻了一倍啊，我个人之百微博翻了百分之六七百。所以你你说房价可能是只是对我觉得很多我们移动互联联不了对互联网的人来说一个选择。但是这个选择其实对于绝大多数的普通人来说，我觉得也太过残酷了。其实也没有必要。你有钱了之后，想购买一辆豪车玩了吗？当然是有的，我只能说是绝对是有的。其实某种程度上在我以前就是根本就没有钱的。穷学生的时候啊，我做梦都想买一辆兰博基尼，哇塞就狂开一阵。但你们就觉就奇怪来说，孙人，你不是二零一三年底就已经赚了一千多万了吗？这个啊而且现在可能你的身价都已经过亿了，是吧？都有更多的钱了，那为什么一直都没有买过那些熟悉我的人？知道我不管，可能连兰博基尼没买，我连一辆车都没有，一辆车都没有，为什么呢？其实嗯要是想听真实原因也很简单，就是没时间，就是我连车都学的是磕磕绊绊。你知道因为因为自从创业之后啊，就是真的是很忙，基本是拿不出甚至学车要求，我要拿出啊四十五天完整时间我都会开车。这件事情我都是磕磕绊绊，去年可能才拿到驾照，而且是现在是可能这种开车水平是完全是新手时间，所以我都其实不敢自己一个人倒的这种水平。所以我基本是不敢开车上路的。同时呢我觉得还是有一个原因，就是用共享经济的空前繁荣。有滴滴啊、易道啊这样的软件，包括美国的uber啊这样的软件。其实你已经没有车，已经完全其实不影响你在大城市的日常交通了。像小城市或者去难到开车去可可西里，去什么美国的一号公路，我也没时间，所以一直也用不上。其实用不上在大城市里面，我觉得uber滴滴遇到的通勤已经很很好了，所以我就根本就没有买过。是，甚至我可以透露一下，我在一个打车软件里面一次性充了八万块钱，他送了我十万，还送我两台电视机。所以我就充了十八万的一个APP里，所以就更没有任何打车的需求了。而且我觉得很好，就是我觉得我自己的体验非常好。首先一我从来不用停车。第二个我啊，在坐车的时候，你大家也知道北京交通企业很不好。从我们中关村到东边任何一个地方，国贸啊，什么地方都得要一两个钟头，而如果开车的话，就只能在那傻逼开着。而嗯自己的话可以干非常多的事情，可以打电话办公是吧？甚至写文章都可以，所以我觉得很省时间。所以到现在目前为止，我从来都没有看过买一辆车的必要性。当然如果人有人白送我啊，我可能还是会收下来。
    """

    # 2. 结构化大纲
    sections = structure_plan_to_json(raw_plan_text)
    print(sections)
    print(f"大纲解析完成，共 {len(sections)} 个章节。")

    # 3. 循环生成
    full_article = ""

    for i, section in enumerate(sections):
        # 生成当前章节
        # TODO 中间内容再加 plan -> write
        section_content = write_section(transcript_text, raw_plan_text, section, full_article)

        # 拼接
        full_article += f"\n\n## {section['title']}\n\n"
        full_article += section_content

        # 实时保存（防止程序崩溃白跑）
        with open('final_article_draft.md', 'w', encoding='utf-8') as f:
            f.write(full_article)

    print("=" * 30)
    print("文章生成完毕！已保存为 final_article_draft.md")