import json
import os
from openai import OpenAI

from openai import OpenAI
os.environ['http_proxy'] = 'http://127.0.0.1:7890'
os.environ['https_proxy'] = 'http://127.0.0.1:7890'
# 1. 配置你的 API (可以用 OpenAI，也可以用兼容 OpenAI 格式的 DeepSeek/Qwen 等)
client = OpenAI(
    # This is the default and can be omitted
    base_url=os.getenv('OPENAI_API_BASE'),
    api_key=os.getenv('GEMINI_API_KEY')
)
MODEL_NAME = "gemini-2.5-pro"  # 或者 "deepseek-chat"


def structure_plan_to_json(plan_text):
    """
    中间层：将非结构化的 Markdown 大纲转化为结构化的 JSON 列表。
    这样我们可以用代码遍历每个章节。
    """
    print("正在将文本大纲转化为结构化数据...")
    prompt = f"""
    我有一个文章大纲，请帮我将其转换为标准的 JSON 格式，以便代码处理。

    【大纲内容】:
    {plan_text}

    【要求】:
    请直接输出一个 JSON List，不要包含 Markdown 格式（如 ```json）。
    List 中的每个元素是一个 Object，包含以下字段：
    - "title": 章节标题
    - "instruction": 该章节的写作指导/摘要
    - "word_count": 预估字数（数字，例如 500）
    """

    try:
        response = client.chat.completions.create(
            model=MODEL_NAME,
            messages=[{"role": "user", "content": prompt}],
            response_format={"type": "json_object"}  # 强制 JSON 模式 (如果模型支持)
        )
        content = response.choices[0].message.content
        # 简单的清洗，防止模型偶尔加 markdown 标记
        if "```json" in content:
            content = content.replace("```json", "").replace("```", "")

        # 尝试解析，通常模型会返回 {"sections": [...]} 或直接 [...]
        data = json.loads(content)
        if isinstance(data, list):
            return data
        elif "sections" in data:
            return data["sections"]
        else:
            # 兜底：假设是一个 dict，取第一个 value
            return list(data.values())[0]

    except Exception as e:
        print(f"大纲结构化失败: {e}")
        return []


def write_section(transcript, full_plan, section_info, previous_content):
    """
    执行层：撰写单个章节
    """
    try:
        with open('prompts/write.txt', encoding='utf-8') as f:
            template = f.read()
    except FileNotFoundError:
        print("错误：请先创建 prompts/writer.txt")
        return ""

    # 截取上文的最后 500 个字符作为 Context，避免上下文过长干扰，同时保持连贯性
    short_prev_context = previous_content[-500:] if previous_content else "（这是文章的开头）"   # TODO 优化 LLM summary

    prompt = template.replace('$TRANSCRIPT$', transcript) \
        .replace('$FULL_PLAN$', full_plan) \
        .replace('$SECTION_TITLE$', section_info.get('title', '')) \
        .replace('$SECTION_INSTRUCTION$', section_info.get('instruction', '')) \
        .replace('$PREVIOUS_CONTEXT$', short_prev_context) \
        .replace('$WORD_COUNT$', str(section_info.get('word_count', 500)))

    print(f"--> 正在生成章节: {section_info.get('title')} ...")

    response = client.chat.completions.create(
        model=MODEL_NAME,
        messages=[{"role": "user", "content": prompt}],
        temperature=0.7,
        timeout=400
    )
    return response.choices[0].message.content


if __name__ == '__main__':
    # 1. 加载数据 (模拟上一步 plan.py 的输出)
    # 实际使用时，你可以把 plan.py 的输出存成文件读取

    # 假设这是 plan.py 生成的 Plan 字符串
    raw_plan_text = """
    好的，遵照指示。作为您的演讲撰稿人，我已经完成了对原始素材的深度分析与清洗，现在为您呈现一篇为孙宇晨量身定制的、充满革命性与煽动性的TED风格演讲大纲。

---

### **Step 2: 演讲大纲 (The Plan)**

#### **1. 演讲标题**

**《打破情感枷锁：成为你人生的唯一CEO》**


#### **2. 核心主旨 (Core Message)**

真正的财富自由，是一场收回人生所有权的革命：它始于划清个人边界，拒绝被情感绑架，从而将未来和增值潜力，牢牢掌握在自己手中。

#### **3. 结构蓝图**

**【引言 (Hook)】** (预估字数：100字)

*   **开场方式**：以一个极具冲击力且普遍存在的“道德困境”开场，迅速引发听众共鸣与自我审视。
*   **内容梗概**：
    *   “‘牺牲我一个，幸福我全家’—— 这句话，你听过吗？甚至，你是不是也曾这样想过？”
    *   “这句听起来无比高尚的话，背后可能隐藏着一场你从未意识到的、最残酷的交易——一场将你未来60年的人生，以极低的价格彻底抛售的交易。”
    *   “今天，我们就要来做一份关于你人生的财务审计，撕开温情脉脉的面纱，直面自由的真相。”

**【现状挑战 (The Problem)】** (预估字数：300字)

*   **核心议题**：揭示“无边界之爱”如何成为通往个人毁灭的陷阱。
*   **内容梗概**：
    *   **引入案例原型**：讲述一个浓缩了无数悲剧的“她”的故事——一个25岁的女孩，为了解决家人的所有问题（妹妹的工作、姥姥的手术），选择嫁给自己不爱的人，放弃了工作、尊严和未来。
    *   **描绘困境**：她以为自己是家庭的英雄，实际上却沦为了“生育的机器”和“终身保姆”。她的丈夫在外彩旗飘飘，而她的人生前景，一片灰暗。
    *   **点破本质**：这不是一个爱情故事，甚至不是一个简单的金钱故事。这是一个关于“边界失守”的故事。在中国，无数年轻人正深陷于这种以爱为名的情感绑架，他们为父母、为兄弟姐妹、为配偶无限度地承担责任，最终透支了自己的一切。这种“中国式亲情”的边界模糊，正是我们通往财富自由道路上最沉重的枷锁。

**【核心观点段落 (The Solution)】** (预估字数：2000字)

**模块一: 重新审计你的人生——边界，是自由的底线**
*   **小标题**: Re-auditing Your Life: Boundaries as the Bottom Line of Freedom
*   **核心逻辑摘要**: 颠覆传统观念，将“边界感”从一个社交礼仪问题，提升到个人生存与发展的核心战略。明确指出，一切悲剧的根源在于权责混淆。我们必须区分“情感连接”与“经济捆绑”，爱可以无限，但责任必须有界。
*   **拟引用的关键素材/金句**:
    *   “人和人之间，首先需要解决一个边界问题。”
    *   “权责一旦打乱，带来的必然是悲剧。在公司经营中如此，在国家治理中如此，在你的人生中，更是如此！”
    *   “情感问题，不要用金钱解决。你可以照顾病重的父母，但你不应该包圆他们的健康问题；你可以给妹妹建议，但她的工作应该由她自己在市场中争取！”
    *   “你的人生，不是家庭的资产负债表，你无需为不属于你的债务兜底。”
*   **预估字数**: 600字

**模块二: 精算你的价值——警惕“自我抛售”的陷阱**
*   **小标题**: Calculating Your True Worth: The Peril of Selling Yourself Short
*   **核心逻辑摘要**: 用最冰冷、最理性的商业逻辑，对案例中的“牺牲”进行量化分析，揭示其惊人的“亏损”。通过精确计算，让听众清晰地看到，感性上的“奉献”在理性上是多么不划算的一笔交易，从而彻底击碎“牺牲是值得的”这一幻觉。
*   **拟引用的关键素材/金句**:
    *   “她以为自己赚了，但我们来算一笔账。三十万彩礼，妹妹的工作，姥姥的手术，加起来不到一百万。她为此付出了什么？未来60年的时间、注意力和尊严。平均每年一万多块钱！在任何一个大城市，哪怕是做服务员，你一年攒下的钱都比这个多！”
    *   “你把自己完全抛售了！而且回报一分钱都没进自己口袋。这是一场彻头彻尾的、亏到血本无归的交易！”
    *   “婚姻本质是一场平等的博弈。当你的价值被严重低估，你离被清算出局也就不远了。”
*   **预估字数**: 700字

**模块三: 夺回控制权——你的革命三步曲**
*   **小标题**: Seizing Control: Your 3-Step Revolution
*   **核心逻辑摘要**: 提供一套清晰、可执行的行动指南，将理论转化为实践。这不仅是解决方案，更是一份革命宣言，赋予听众打破现状的武器和勇气。
*   **核心步骤**:
    1.  **思想革命：成为你人生的CEO。** 首要的是认知升级，承认并坚信“你只对你自己的人生负责”。停止自我贬低，认识到即使起点再低，一个年轻人在这个时代也拥有无限可能。
    2.  **空间革命：物理切割创造边界。** 强烈建议年轻人离开家乡，去更大的城市。物理距离是建立心理边界最有效的方式。新环境会带来新机会、新认知，让你摆脱原生家庭的引力场。
    3.  **投资革命：All in 你自己。** 将你早期所有的收入，投资于自我提升和培训，而不是填补家庭的无底洞。对于已经深陷泥潭的人，唯一出路是：不惜一切代价，夺回你的“工作权”，重新融入社会，积累博弈的资本。
*   **拟引用的关键素材/金句**:
    *   “每个人，都必须将资产增长、未来和自由，都掌握在自己手中！”
    *   “如果你连工作的权利都没有，你不是在婚姻里，你是在监狱里。这时候，离婚不是选择，是唯一的出路。”
*   **预估字数**: 700字

**【愿景与号召 (Vision & Call to Action)】** (预估字数：200字)

*   **升华主题**：将个人选择上升为一代人的觉醒。
*   **内容梗概**：
    *   “划清边界，不是自私，而是对你人生潜力的最大责任。你强大了，才是对爱你的人最好的回馈。”
    *   “我看到的未来，是新一代的年轻人，不再被传统和情感所束缚。他们是独立的个体，是自己命运的掌舵者，他们通过平等的协作，建立更健康的家庭与社会关系。”
    *   **发出号召**：“所以，从今天起，去打那通最难打的电话，去进行那场最艰难的对话，去划下你人生的第一条边界线。这，就是你财富自由革命的开始。我，在自由的另一端等你！”
    """

    # 假设这是原始转录文本
    transcript_text = """
    大家好，我是陪我APP创始人孙雨辰生于一九九零年，现在是马云爸爸创办的湖畔大学首期唯一的九零后学员。我以前从一个只能考三本的学生，花了一年时间考上了北大。从一个很普通的穷学生，通过自己的努力投资创业，赚到了几千万。从四处碰壁，无人投资，最后到现在创业小有所成。我一直坚信，一个有梦想的人，带着刺也能成功，甚至一个带着刺的人更容易走向成功。我想邀你一起与我踏上财富，自由革命之路，我希望在财富自由的另一边等着你。下面是我们的案例分析了已经。其实前面经过啊两期的分析啊，相信大家对财富自由是什么以及财富自由作为一整套信仰的观点呢，其实已经有了一些潜移默化的了解。所以呢大家到我们的喜马拉雅和新浪微博的留言也非常踊跃啊。其实今天呢我是挑出了啊在我们留言中的粉丝的话啊，然后我们把它具体来分析一下。而且我觉得这些啊话其实很有代表性啊，这也为什么我愿意分析啊，很有代表性啊。同时呢我觉得跟他们分析他们的案例啊，也能让我们大家学到很多。其实这也是我们的第一次案例分析以后，我们的这个课程呢都会有前面先有两个理论分析，后面跟两个课程分析最后是一个总结，也希望大家从这个案例分析中能够学到尽可能多的知识。今天我们要回答第一个问题。第一个问题是你因为金钱在时间、注意力、情感、尊严上都付出过什么代价。啊，我们现在来看一位来自武汉的啊女生的回复啊，叫玻璃。其实是一个年纪，并不是非常大的女生，也是一个二十五岁的女生。然后现在是在城市的武汉啊，她呢啊我给大家先转述一下她的目前的基本情况吧。啊，她以前呢是一个嗯首先是长相质质都让人感觉比较舒服的。妹子啊，颜值我们打分就打啊，妆前五妆后六吧。咱咱绝大多数对自己的评价其实可能会失调一些。然后妹子呢从小学习不好，然后在武汉一个职高学完酒店管理之后呢，就在酒店当服务员妹纸。后来呢结婚呢，在他们跟他工作酒店的老板的儿子结婚了啊，所以看到妹子还是有一手的。我们一般认为这样的人其实情商都是很高的，叫我们经常讲叫智商不够情商来凑是吧？啊，这样的人其实往往比智商高的人还厉害得多。然后老公呢就给了他们家啊一笔彩礼，然后有三十万左右，然后妹子的家境很差，有一个妹妹，然后父母都是活警企业的下岗职工。嗯，然后现在就是基本摆摊吧，摆他的状态。然后少东家呢除了彩礼呢，也解决了妹妹的工作，帮她的姥姥做了心脏搭桥手术，还给他的名下买了房子。但但是他们呢就没有没有举行婚礼。因为呢少东家的父母那个可能并不喜欢这个出身底层的媳妇。他们家现在的问题就是呢，这个妹子觉得她跟她老公其实已经没有什么感情了，本质啊，而且她老公对她的要求主要就是好好在家生孩子带孩子。她个人感觉呢自己其实就是一个生孩子的机器。她老公呢在外面有很多很多啊，在家中采旗，家中红旗不打，外面彩旗飘飘了。然后呢，妹子呢现在就基本上也没有办法，所以她呢家中一爱单位自己的话叫做苦了我一个幸福福全全，你知道吗？啊？是这样的价值观。然后他通过他认为自己通过努力吧，养活了一家人，然后家人也比较满意嘛。然后嗯妹子现在平常呢觉得自己这辈子也值了，虽然偶尔哭一下，感觉自己因为当然没什么前途啊，前景非常灰暗。换要要我是妹子，很有可能我会选择自杀了。这时候已经，但是妹子觉得还已经值了，然后觉得还能再要求什么呢？而且妹子觉得自己啊其实是不是也没有为金钱付出时间、注意力和情感。他听了我的节目啊，他他觉得是这样吗？他觉得没有付出啊，时间、注意力和情感。然后他问我是点吗？然后我们今天消化一些时间，好好谈谈这个案例。其实听完这个案例，我个人还是挺痛心的啊，非常痛心。首先呢其实啊我先讲几点我的看法吧，再讲讲我们对啊我们给玻璃的建议，以及啊其实我觉得他应该怎么做啊一些建议。其实首先嗯我先讲讲我的父母，其实就很平常的，可能比下岗国营企业的啊父母还是好一些的。但是首先一我觉得我的父母一对我的成长并没有任何物质上实质性的帮助。就是啊上普通高中的时候给钱在北大读书的时候，一年四千块学费吧。所以我觉得我跟妹纸其实相比啊，我觉得我的家庭上并没有优越太多啊，等一下我会讲，就妹子这个情况怎么处理。而且我觉得其实就我自己的感受，以我的经验和妹纸的相比啊，其实很具有参考性。我先讲一下，其实啊这个在现在目前中国都很普遍，以及以前传统社会，以前郭德纲老师讲的是吧？民国清初啊这种事儿更多了。就绝大多数家庭呢把女孩儿嫁人当做是一个翻身的重要手段。而且呢他们其实嗯就传统社会啊认为女性呢是一种可以买卖的物品啊，当然还是一种较为贵重的物品了。在物品里还是算贵重的，但是不被认为是家族传承的继承人，所以呢就已经不当成人了。所以呢家长的想法总是希望能够早日卖掉，而且当然希望是个糕点呢能把她卖掉。虽然这个已经是二十一世纪了，但是其实很多家长的内心深处还是这么认为的。女生其实我们觉得她其实就是一个为家庭卖身变成生育机器的一个女生啊一个女孩。其实这个情况并不是特例，前一段时间不知道大家没有微博关注啊，在前段时间在微博上也是基本上卖掉她常火的一个新闻，就是一个叫徐婷的女演员。她的家庭其实也是典型这样的。当然，她是因为积劳成疾，为癌症去世了。她的家庭结构呢也是因为全家的小孩上学吃饭，包括她父母、家庭的老人的生老病死，全部都是依靠认为的。和这个女孩非常像。就是刚才当然她我觉得也是一种自我打趣吧，叫什么牺牲我一个什么幸福，我全家一套。其实在中国社会中挺频繁存在的。其实这道题目为什么我愿意拿出来啊，我觉得这是一道财富自由的典型题。嗯，这不仅与财富自由相关，我觉得首先象征着我，紧接着我们后面也会重点去讲解的这包括这也是我们一整个九零后财富自由之路。重点需要说的就是嗯人和人首先需要解决一个边界问题，我们讲讲究人与人的边界问题，其实我们跟陌生人的边界其实也是有的。但是也很少讲啊，我们需要重点讲的就是啊人与父母与兄弟姐妹与配偶的边界关系问题。因为中国人呢往往啊在处理刚才讲的与父母、兄弟姐妹和配偶的时候，容易出现一个很大的问题，就是彻底没边界啊。可能我们经常认为跟陌生人的，虽然其中国人都已经经常愚蠢到有可能跟陌生人的边界问题，经常他也会搞混。就比如说女生觉得怎么可以吃兔兔啊，以及救狗啊，以及大量好像陌生人都不行。我们要去募捐哪，在这些问题啊跟陌生人处理的边界都会出问题。当然我们已经讲过了，这些问题，用两个词解决是干你屁事和干我屁事来解决。但是与父母、兄弟姐妹和配偶的时候更容易出现这样的情况，就是边界的混淆，边界混淆当然很简单就融为一体了。啊，首先我父母的事就是我的事儿，我兄弟姐妹的事儿，我就说我的事儿，我配偶的事儿就是我的事儿啊，这基本关键边界模糊，就基本上就是这样去理解吧。我们认为啊一旦模糊是非常恐怖的。因为任何边界为什么之前强调边界啊，就是权责要分清。不光是其实我们的家庭关系中，你在公司经营，甚至国家经营中，权责一旦打乱带来的都肯定是悲剧啊，绝对是悲剧。比如说就妹子这个情况来说啊，我们认为人与人是具有独立性是有边界性的。所以在正常情况下，双方不应就对方的问题进行经济行为的干预，可以进行情感交流和补偿，是没有问题的。像我们认为，人与父母、兄弟姐妹、配偶重大的连接，叫情感连接。但是我们其实以前也讲过，一个著名的就是情感问题，不要用金钱解决。也就是你比如说你父母哪怕病重了，你可以一定程度的照顾他，根据他情感一定程度的危机，但是我们首先不推荐。即便你父母病重了，你要协助他解决他的健康问题，而不是把她的健康问题包圆了。而且也要尽可能的挖掘父母的能力，自己去解决自己的健康问题。这个是一个处理父母兄弟姐妹，包括配偶的关系的一个非常重要的前提和预期管理。而且你也不能给对方一个，你会把他包圆了的给他兜底的预期管理，也不要做到这一点啊，是非常重要的。像在这个具体案例里面来说，妹妹的工作理应由自己解决。就是妹妹在劳动市场中能拿到什么样的价格，是妹妹自己找工作，其实跟你是一点关系都没有的，你可以给她起到一些建议。就比如说今天我们这个节目给玻璃的建议一样，你可以给他一些建议，甚至给他一些你认为对的事情是如果听不听做不做，完全是他自己啊。因为你想如果你帮妹妹找到工作，其实妹妹如果工作没有干好或出各种各样的问题，她最后还是会来找你的。所以我们要讲一点啊，首先你解决一次，这不是一次性解决问题是如果你一旦抱怨是永远兜底啊，所以想好你有没有这样的兜底出资，而且我觉得甚至这不是一个能力问题，而是从人和人边界角度出发，就不应该是你兜底。第二，姥姥的心脏搭桥手术，我们认为也理应由姥姥解决，包括姥姥自己出资，或者姥姥自己应该以前买过医疗保险，有保险出资。即便退一万步讲去模糊边界关系，那也应该由姥姥的子女解决，而不应由姥姥的孙女这辈子人来解决，这是一个典型问题。而在这个里面，妹妹的工作，姥姥的心脏搭桥手术都由配偶解决了。这个当然就带来后面的一系列问题。所以说我们从我们发，我们会发现啊，就是我们我觉得我们总结问题还是非常深刻的。因为他的所有问题，我们觉得根源都是因为没有化清与周边人的边界所导致的。所以呢最后妹子对于解决妹妹和姥姥的心脏搭桥都不富有解决问题，但是强行解决而导致了第三个问题。出现第三个问题，当然就是妹妹子选择由配偶解决了配偶解决之后，本质就破坏了与配偶的边界。那么配偶来破坏你的边界，把你当成生孩子的机器，那就非常正常，也是理所当然的了。所以呢妹子刚才还问我说，哎，感觉自己没有付出。我们上期讲的时间注意力和金钱的尊严啊，我我我当时觉得肯定是付出了，而且我觉得付出的是非常惨痛。妹子不仅付出了她，就我刚才讲的一系列的时间、注意力和尊严，甚至他还透支了他未来三十年、四十年、五十年的所有的时间、注意力和尊严。要注意是所有因为他现在这个妹子现在没有任何工作，那没有工作，那他所有的时间都是带小孩和呆在家里，那她基本所有的时间都付出了注意力，大家就不用说了。因为人我前面讲了，她其实在相当长时间内做好一件事情的注意力，就只有一只能做好一件事情，要不你是做你的工作，要不然比如今天晚上咱们在录这个节目，这只能做一件事情。尊近的注意没有了，但尊严就更不用说了，已经被践踏殆尽了吧。我认为啊，因为首先我觉得如果你跟一个不爱的人结婚，以及维持一段不爱的婚姻，这已经是对你的尊严的最大程度的挑战了。如果这都不算付出尊严，我不晓得什么是付出尊严。其实啊我们把时间拉长来看一个一个人的人生啊，一生是很长的，自我成长的区间也是很长的。其实如果这个妹子结婚前能够听到我们的这个专栏啊，听到我这个节目，我的建议是，包括今天说不定有很多听众就在听自己也遇到这样的问题。我们的建议是，比如这时候这个妹子还没结婚。我们的建议是什么呢？首先应该明确家庭的责任区间，不承担妹妹和姥姥的一切责任。这一点也应该跟妹妹和姥姥说清楚，自己靠自己啊。任何人的责任边界应该划分清楚，包括也要跟父母讲清楚，所有人要对自己的管理责任边界有一定程度的认可。包括这种边界你要跟人家讲清楚，要获得对方的认可和谅解。这一点我们其实后面跟父母啊如何打交道，那一章会具体讲的。这个是我们后面一章要讲的，就是我要取得对方的谅解。你也不是说我说啊，就是界界化就闪然，这也不行的。对方要谅解，如果对方不谅解，要想办法进行妥协。但是啊要让对方了解你正确的三观是很重要的，就是我们不要求求方方解解们的三观。但是我们需要要对方陈述述们的三观，并且取得妥协。所以我觉得第一点要明确边界，然后把这件事情跟家人讲清楚。然后第二个呢，我们就建议妹子不要待在武汉了，最好换一个更大的城市，一定要是在家庭之外的，离得比较远呢，最好是离得近的。比如说有上海、北京、广州、深圳，其实从武汉出发都差不多距离这些。首先因为为什么我们要建议这样的，因为呢我们认为切换城市有助于保持亲人与你的边界。中国绝大多数人呢之所以啊边界失守，很大程度上与他和父母住一个城市，以及跟父母，甚至住在一块儿有非常大的关系。所以我们认为呢要保持与亲人的边界，一个重要的方式就是切换城市。同时呢这些城市即便是同样的工作相比，武汉也会有一个很大的提升。就是你的工资也会有很大的提升，同时对于年轻人才也渴更为渴求，成长空间也更大啊。我首先并不认为啊这个妹子在职高毕业之后，其实在社会上没有任何竞争力，我并不这样认为。我甚至认为一个年轻的男性和女性在大城市，不论你读没读过书，在中国这样机会遍地高速增长的城市还是具有很强竞争力的。其实可能我觉得目前仅次于中国机会的是印度和越南就在这种就是行业高速增长，而且有大量新兴机会和工作的城市。任何一个即便没有读过书的年轻人，其实也是可以通过自己的勤劳苦干去改变自己的一生的。所以我首先不认为妹子的成长空间是没有的，只能到小地方当服务员。相反，我认为在小地方当服务员，恰恰是他对自己自我认知太低所导致的自我实现预期。就你觉得自己不行，那就只能当服务员。那当了服务员，就只能最后被像嫁人一样卖掉了。那你可能也就只配有这样的人生。所以我觉得这个很大程度上是一个自我实现预期的问题。同时呢我希望妹子要谨慎选择婚姻对象。当然了，这是她结婚之前啊，我等下会在结婚之后，现在该怎么办啊？结婚之前的话，我们希望他能谨慎选择，然后同时将早期的绝大多数收入，因为他有收入嘛。而我认为现在像年轻人啊，一个年轻人啊，如果明确好家庭责任边界，一般人的收入要远大于他的支出啊啊，要真是远大于否则你说人类发展这么几百年，难道白发展了吗？我们创造的机会现在都要远远大于，就是你要完成你生存所需要的钱的。所以呢这一部分收入呢应该进行自我提升和自我培训，快速提升自己到二十岁到三十岁的一个增长速度。当然了，来定于我们的专栏，其实就是提升自我培训的一个非常要的的方式。法法因为学一一正正确的三，我我觉要比比所有的事情都要增加重要。当然了，现在妹子已经结婚了。那我们回头看一看这个结婚这个事儿本身怎么判断。其实从财富角度来说呢，妹子的选择啊，他是现阶段将自己完全抛售了，是完全抛售。注意还不是只卖一段啊，是可能将未来就是比如说他二十，他里面没讲他什么时候结的婚呢，现在已经二十五了，我们假定已经结婚三到四年了吧。二十二岁直接比如说妹子今后活了八十岁，直接卖了六十年，完全抛售。那基本上一个人整个卖掉了，然后卖的价格我们注意啊，我们看一看抛售的价格为三十万的现金、妹妹的工作，姥姥手术搭桥的费用以及一套正常住房的每月房租。在武汉的首先要注意啊，而当然她跟她老公还是合租嘛，要把他自己单独住，而且。首先要注意，因为新婚姻法已经规定了房子，只要是男方出的钱永远是男方的，无论写不写你的名字，离婚的时候都永远是男方的。所以我们并不能认为，就妹子刚才说的给他那套房子是他的。不知道妹子知不知道，这其实是很残忍的事实，但是你倒要知道。所以这就是一套正常房的房租。其实啊我个人认为其实妹妹的工作可以自己找的，我并不认为因为她妹妹比她还小啊，我认为一个正常的年轻人，只要有一定的闯进在大部分城市都可以立租。更何况武汉这种二三线城市啊是完全没问题的。所以我个人认为妹妹的工作并不用报价太高，姥姥的心脏搭桥手术。其实我们认真去查一下，一般在一个武汉这个地方做一个手术，也就十到二十万的钱也可以拿下的啊。一个正常房子的每月房租，我觉得也其实并不多。像武汉那样的城市，我们一年给他租个估个五万，我觉得都并不是非常夸张的。所以可能嗯比如说房租我们先按十年的算吧，嗯其实也就是加起来不到一百吧，可能也就是八十到九十万。妹子就把自己给彻底抛售了，八十万到九十万抛售六十年的价格。那么平均妹子我们稍微有数学常识的，可能一年有一万两千多块钱左右啊，一万两千多块到一万三吧，一万三千块钱。而我们要注意一万三千块钱。我们相信妹子其实去任何一个地方从事，即便是服务员的工作。刚才我讲的大城市一年她能攒下的钱都要远远多于一万三千块钱。所以妹子其实觉得自己还赚了，可能其实并没有我们算了这个账来看啊，妹子不仅没赚，而且是卖的亏大方了啊，可以说是亏大发了。而且刚才妹子觉得自己装妆前五妆后六呢，是吧？我觉得对于颜值，其实我们也经常经常在现代社会中，也是有一定竞争力的吧。其实她可能会能过得更狠，生活过得更好，而且还要一点。刚才我觉得我们大家也要注意的是，这些抛售得来的回报，妹子自己一分钱都没拿，而是全部给了家庭。那三十万也是给家庭的礼金。而我们回头想一想啊，就经常我们讲的我爱国国爱我嘛，是吧？里面就是妹子爱他的家庭。但是以刚才我们看的这个家庭的情况来看，家庭能给妹子提供的帮助是非常有限的。所以就是妹子抛售自己，成为沦为了一个机器，抵押了未来二十到三十年任何增长的可能，同时还不具有任何自身的回报。这时候妹子其实我们看当她带小孩儿完全全带孩孩在家里已经沦为保姆了吧。可以这么说，嗯，虽然难听了一点，但的确是这样，她在婚姻中的未来博弈能力也是非常低的，未来的情况只会越来越差，而且这是我觉得是非常恐怖的。因为她后来她老老公呢，基本按我们的现在情况是看是无论做出什么样的决定，她都只能逆来顺受。只要她老公不结婚啊，不离婚，那想干什么干什么？那就是无条件处置，那简直比。因为因为妹子越拖到后面，因为你具有的劳动技能越差呀，年龄越大。我们并不认为首先一我们并不认为女性在婚姻市场中年龄、大会出问题。如果你自我提升做好的话，但是如果你没有任何工作技能，随着年龄推推移，你的工作在劳动市场上的竞争力是绝对会降低的这是毫无疑问的。所以随着时间的推移，我们觉得情况会越来越差。所以其实我我这时候真的皇帝不及太监急，我还挺替这个妹子着急的。我们认为财富自由成长之路，我们这个节目也告诉我们啊，每个人必须将资产增长，未来和自由都掌握在自身手中。妹子其实当初如果抛售这八十万，也应该领现金存在自己账户里啊。哎呀，我都不知道该怎么说了。现在这个婚姻关系是非常危险的，而且这份关系能维持下去的博弈可能性也很低的。因为我们知道，婚姻本质是一场平等博弈，如果你在博弈中差的太远，被消灭的可能性也很大。所以我们现在觉得妹子现在唯一能要求的，我觉得是以离婚被罚码。而向她的老公要求工作权，无论如何都要出去工作，参加重新培训，先具备一定的社会技能，在武汉立足，再一步步想办法。同时这时候跟家庭明确，边界也不是来不及。这时候跟家庭，比如说跟姥姥说好心脏搭桥手术做完了，但是您以后的健康问题得您负责了，我是不会复杂，我可以给您送终，但是不会负责。您的健康问题给妹妹也是明确归属工作，虽然是我找的，但是比如说甚至比如说我现在可能还是个老板酒店的老板娘，甚至是但是妹妹在这个酒店工作是否合格，服务员当的是否好，那都完全是由这个酒店的经济管理人负责了。你是只能自己找自己的工作，我们是不能负责的。当然我们觉得妹子订阅我们的专栏也是非常必要的。当然我觉得她现在很幸运啊，那我们这留言我们能给他提供帮助。但是我觉得现阶段能够提供的帮助是，他首先应该获得工作权利，尽早融入这个社会进行工作。而且现在也很多职业女性可以在自己带好小孩的情况下工作。其实其实所以工作我们觉得并不是很大的工题。如果我们觉得她的丈夫不允许妹子有工作权，那就只能离婚。首先一这个婚姻本身就没有什么感情。其二呢，如果连工作权都不给，那是基本连个人的独立权都不给的，完全要沦为奴隶的。这个就即便相爱的婚姻也不能够承受啊，也都是必须离婚的。我们认为所以在这段关系中呢啊我们认为当然了，妹子还有婚姻法保护啊，这时候还是要感谢婚姻法了。就是如果你离婚，估计你老公还是得给你一笔补偿的，但是要注意这笔补偿是绝对不能再给家庭了。你要为自己考虑啊，想想自己在这个社会中如何立足自己，未来甚至长达二到三十年应该如何发展呢？好好想一想，好吧啊，这就是我们第一个问题的回答。
    """

    # 2. 结构化大纲
    sections = structure_plan_to_json(raw_plan_text)
    print(f"大纲解析完成，共 {len(sections)} 个章节。")

    # 3. 循环生成
    full_article = ""

    for i, section in enumerate(sections):
        # 生成当前章节
        # TODO 中间内容再加 plan -> write
        section_content = write_section(transcript_text, raw_plan_text, section, full_article)

        # 拼接
        full_article += f"\n\n## {section['title']}\n\n"
        full_article += section_content

        # 实时保存（防止程序崩溃白跑）
        with open('final_article_draft.md', 'w', encoding='utf-8') as f:
            f.write(full_article)

    print("=" * 30)
    print("文章生成完毕！已保存为 final_article_draft.md")